<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="https://fiorenzofdt.com/wp-content/uploads/fiorenzo-digital-teamwear.jpg">
  <title>FDT | Contabilizzatore</title>
  <link rel="stylesheet" href="./style.css">
  <div class="container">
</head>

<body>

  <div class="container">
    <img src="./FDT.png" class="image-container">
<br><br><br>
    <input type="file" id="xlsFile" accept=".xls ,.XLS, .xlsx, .XLSX" />
    <button onclick="convertXlsToCsv()">XLS >>> CSV</button>
    <br><br><br>

    <input type="file" id="fileInput" accept=".csv">

    <button class="buttonC" onclick="processCSV()">Estrai colonne</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
  <script>
    function convertXlsToCsv() {
      const fileInput = document.getElementById('xlsFile');
      const file = fileInput.files[0];

      if (!file) {
        console.error('Seleziona un file XLS.');
        return;
      }

      const reader = new FileReader();

      reader.onload = function (event) {
        const data = new Uint8Array(event.target.result);
        const workbook = XLSX.read(data, { type: 'array' });

        const worksheet = workbook.Sheets[workbook.SheetNames[0]];
        const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

        let csvContent = '';

        jsonData.forEach(row => {
          const rowString = row.join(',');
          csvContent += rowString + '\n';
        });

        // Create a Blob with the CSV content
        const csvBlob = new Blob([csvContent], { type: 'text/csv' });

        // Create a download link for the CSV file
        const downloadLink = document.createElement('a');
        downloadLink.href = URL.createObjectURL(csvBlob);
        downloadLink.download = file.name.replace(/\.[^.]+$/, '.csv');
        downloadLink.click();
      };

      reader.onerror = function (error) {
        console.error('Errore durante la lettura del file XLS:', error);
      };

      reader.readAsArrayBuffer(file);
    }

    //---------------------------------------------------------

    function processCSV() {
      // Ottiene il file selezionato dall'input
      const fileInput = document.getElementById('fileInput');
      const file = fileInput.files[0];

      // Crea un oggetto FileReader per leggere il contenuto del file
      const reader = new FileReader();

      // Funzione chiamata quando la lettura del file Ã¨ completata
      reader.onload = function (e) {
        // Ottiene il contenuto del file CSV
        const csv = e.target.result;

        // Modifica la prima riga in "A, B, C"
        const modifiedCSV = modifyCSV(csv);

        // Crea un oggetto Blob con il contenuto CSV modificato
        const modifiedBlob = new Blob([modifiedCSV], { type: 'text/csv' });

        // Crea un link per il download del file CSV modificato
        const downloadLink = document.createElement('a');
        downloadLink.href = URL.createObjectURL(modifiedBlob);
        downloadLink.download = file.name;
        downloadLink.click();
      };

      // Legge il contenuto del file come testo
      reader.readAsText(file);
    }

    function modifyCSV(csv) {
      const lines = csv.split('\n');
      lines[0] = 'vabrsd,vabind,vabcad,vablod,vabprd,vabtic,vabcas'; // Modifica la prima riga con "A, B, C"
      return lines.join('\n');
    }

    function saveFile(content, fileName) {
      // Crea un oggetto Blob contenente il contenuto del file
      if (navigator.msSaveBlob) { // Se il browser supporta il metodo msSaveBlob (Internet Explorer)
        navigator.msSaveBlob(content, fileName); // Salva il file usando msSaveBlob
      } else {
        // Altrimenti, crea un link temporaneo per il download del file
        const link = document.createElement('a');
        link.href = window.URL.createObjectURL(content);
        link.setAttribute('download', fileName);

        // Aggiunge il link al documento, lo attiva e lo rimuove successivamente
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }
    }

  </script>
</body>

</html>
